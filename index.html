<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI ë©”íƒ€ë°ì´í„° í†µí•© ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; background: #f0f2f5; color: #1a1a2e; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); color: white; padding: 24px 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 100; }
        .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 6px; letter-spacing: -0.5px; }
        .header p { font-size: 13px; opacity: 0.75; line-height: 1.6; }
        .container { max-width: 1600px; margin: 0 auto; padding: 24px 40px; }
        .upload-area { background: white; border: 2px dashed #c5cae9; border-radius: 16px; padding: 60px 40px; text-align: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 24px; }
        .upload-area:hover, .upload-area.dragover { border-color: #3f51b5; background: #e8eaf6; transform: translateY(-2px); }
        .upload-area .icon { font-size: 48px; margin-bottom: 16px; }
        .upload-area h2 { font-size: 18px; color: #333; margin-bottom: 8px; }
        .upload-area p { font-size: 14px; color: #888; }
        .upload-area.loaded { border-color: #4caf50; background: #e8f5e9; padding: 20px 40px; cursor: default; }
        .upload-area.loaded .icon { font-size: 28px; margin-bottom: 8px; }
        .upload-area.loaded h2 { color: #2e7d32; font-size: 15px; }
        .search-section { display: none; background: white; border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); margin-bottom: 20px; }
        .search-section.visible { display: block; }
        .search-row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .search-input-wrapper { flex: 1; min-width: 300px; position: relative; }
        .search-input-wrapper .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 18px; color: #999; }
        .search-input { width: 100%; padding: 12px 16px 12px 42px; font-size: 15px; border: 2px solid #e0e0e0; border-radius: 10px; outline: none; transition: border-color 0.2s; font-family: inherit; }
        .search-input:focus { border-color: #3f51b5; box-shadow: 0 0 0 3px rgba(63,81,181,0.1); }
        .column-select { padding: 12px 16px; font-size: 14px; border: 2px solid #e0e0e0; border-radius: 10px; outline: none; background: white; cursor: pointer; font-family: inherit; min-width: 160px; }
        .column-select:focus { border-color: #3f51b5; }
        .btn { padding: 12px 24px; font-size: 14px; font-weight: 600; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: #3f51b5; color: white; }
        .btn-primary:hover { background: #303f9f; }
        .btn-secondary { background: #f5f5f5; color: #555; border: 1px solid #ddd; }
        .btn-secondary:hover { background: #e0e0e0; }
        .btn-export { background: #2e7d32; color: white; }
        .btn-export:hover { background: #1b5e20; }
        .stats-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; flex-wrap: wrap; gap: 10px; }
        .stats-info { font-size: 14px; color: #666; }
        .stats-info strong { color: #3f51b5; font-size: 16px; }
        .table-container { display: none; background: white; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); overflow: hidden; }
        .table-container.visible { display: block; }
        .table-scroll { overflow-x: auto; max-height: 65vh; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        thead { position: sticky; top: 0; z-index: 10; }
        thead th { background: #1a1a2e; color: white; padding: 14px 16px; text-align: left; font-weight: 600; font-size: 13px; white-space: nowrap; cursor: pointer; user-select: none; transition: background 0.2s; border-right: 1px solid rgba(255,255,255,0.1); }
        thead th:hover { background: #0f3460; }
        thead th .sort-arrow { margin-left: 4px; opacity: 0.4; font-size: 11px; }
        thead th.sorted .sort-arrow { opacity: 1; }
        tbody tr { transition: background 0.15s; border-bottom: 1px solid #f0f0f0; }
        tbody tr:hover { background: #e8eaf6; }
        tbody tr:nth-child(even) { background: #fafafa; }
        tbody tr:nth-child(even):hover { background: #e8eaf6; }
        tbody td { padding: 11px 16px; max-width: 350px; word-break: break-word; line-height: 1.5; vertical-align: top; border-right: 1px solid #f0f0f0; }
        .row-num { color: #999; font-size: 12px; text-align: center; min-width: 50px; font-weight: 500; }
        .highlight { background: #fff176; padding: 1px 2px; border-radius: 3px; font-weight: 600; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 4px; padding: 20px; flex-wrap: wrap; }
        .page-btn { min-width: 38px; height: 38px; border: 1px solid #ddd; background: white; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-family: inherit; }
        .page-btn:hover { background: #e8eaf6; border-color: #3f51b5; }
        .page-btn.active { background: #3f51b5; color: white; border-color: #3f51b5; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .page-dots { display: flex; align-items: center; padding: 0 4px; color: #999; }
        .per-page { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #666; }
        .per-page select { padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; font-family: inherit; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.visible { display: flex; }
        .modal { background: white; border-radius: 16px; max-width: 700px; width: 100%; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { background: #1a1a2e; color: white; padding: 20px 24px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 16px; }
        .modal-close { background: none; border: none; color: white; font-size: 24px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; }
        .modal-close:hover { opacity: 1; }
        .modal-body { padding: 24px; }
        .detail-item { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #f0f0f0; }
        .detail-item:last-child { border-bottom: none; }
        .detail-label { font-size: 12px; font-weight: 700; color: #3f51b5; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px; }
        .detail-value { font-size: 14px; line-height: 1.7; color: #333; white-space: pre-wrap; word-break: break-word; background: #f8f9fa; padding: 10px 14px; border-radius: 8px; }
        .loading { display: none; text-align: center; padding: 40px; color: #666; }
        .loading.visible { display: block; }
        .spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #e0e0e0; border-top-color: #3f51b5; border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .container { padding: 16px; } .header { padding: 16px 20px; } .search-row { flex-direction: column; } .search-input-wrapper { min-width: 100%; } }
        .toast { position: fixed; bottom: 30px; right: 30px; background: #333; color: white; padding: 14px 24px; border-radius: 10px; font-size: 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 2000; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .table-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
        .table-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .table-scroll::-webkit-scrollbar-thumb { background: #bbb; border-radius: 4px; }
        .table-scroll::-webkit-scrollbar-thumb:hover { background: #999; }
    </style>
</head>
<body>

<div class="header">
    <h1>BI ë©”íƒ€ë°ì´í„° í†µí•© ê²€ìƒ‰ ì‹œìŠ¤í…œ</h1>
    <p>BI ë°ì´í„°ì…‹ ë° ê³„ì‚° í•„ë“œ(ì§€í‘œ ì‚°ì‹)ë¥¼ í†µí•© ê´€ë¦¬í•˜ê³ , í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ê³¼ ì¡°ê±´ í•„í„°ë§ì„ í†µí•´ í•„ìš”í•œ ì§€í‘œ ì •ì˜ë¥¼ ì‹ ì†í•˜ê²Œ íƒìƒ‰</p>
</div>

<div class="container">
    <div class="loading" id="autoLoading" style="display:block;padding:30px;">
        <div class="spinner"></div>
        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div class="upload-area" id="uploadArea" style="display:none;">
        <div class="icon">ğŸ“‚</div>
        <h2>íŒŒì¼ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</h2>
        <p>CSV, Excel(.xlsx, .xls) íŒŒì¼ì„ ì§€ì›í•©ë‹ˆë‹¤ Â· í•œê¸€ ì¸ì½”ë”© ìë™ ê°ì§€</p>
        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display:none">
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘...</p>
    </div>

    <div class="search-section" id="searchSection">
        <div class="search-row">
            <div class="search-input-wrapper">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Enterë¡œ ê²€ìƒ‰)" autocomplete="off">
            </div>
            <select class="column-select" id="columnSelect">
                <option value="all">ì „ì²´ ì»¬ëŸ¼ ê²€ìƒ‰</option>
            </select>
            <button class="btn btn-primary" id="searchBtn">ê²€ìƒ‰</button>
            <button class="btn btn-secondary" id="resetBtn">ì´ˆê¸°í™”</button>
            <button class="btn btn-export" id="exportBtn">ğŸ“¥ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
        </div>
        <div class="stats-bar">
            <div class="stats-info" id="statsInfo">ì´ <strong>0</strong>ê±´ì˜ ë°ì´í„°</div>
            <div class="per-page">
                <span>í˜ì´ì§€ë‹¹</span>
                <select id="perPageSelect">
                    <option value="30">30ê±´</option>
                    <option value="50" selected>50ê±´</option>
                    <option value="100">100ê±´</option>
                    <option value="200">200ê±´</option>
                    <option value="500">500ê±´</option>
                </select>
            </div>
        </div>
    </div>

    <div class="table-container" id="tableContainer">
        <div class="table-scroll">
            <table id="dataTable">
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <div class="pagination" id="pagination"></div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <h3>ìƒì„¸ ì •ë³´</h3>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
(function() {
    let allData = [], filteredData = [], headers = [];
    let currentPage = 1, perPage = 50, sortCol = -1, sortAsc = true, searchTerm = '', searchColumn = 'all';

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const loading = document.getElementById('loading');
    const searchSection = document.getElementById('searchSection');
    const searchInput = document.getElementById('searchInput');
    const columnSelect = document.getElementById('columnSelect');
    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');
    const statsInfo = document.getElementById('statsInfo');
    const tableContainer = document.getElementById('tableContainer');
    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    const pagination = document.getElementById('pagination');
    const perPageSelect = document.getElementById('perPageSelect');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');

    uploadArea.addEventListener('click', (e) => { if (e.target.closest('.sheet-selector')) return; fileInput.click(); });
    fileInput.addEventListener('change', (e) => { if (e.target.files.length > 0) handleFile(e.target.files[0]); });
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); });
    uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]); });

    searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') doSearch(); });
    searchBtn.addEventListener('click', doSearch);
    resetBtn.addEventListener('click', doReset);
    exportBtn.addEventListener('click', doExport);
    perPageSelect.addEventListener('change', () => { perPage = parseInt(perPageSelect.value); currentPage = 1; renderTable(); });

    modalClose.addEventListener('click', () => modalOverlay.classList.remove('visible'));
    modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.classList.remove('visible'); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') modalOverlay.classList.remove('visible'); });

    async function handleFile(file) {
        const ext = file.name.split('.').pop().toLowerCase();
        if (!['csv', 'xlsx', 'xls'].includes(ext)) { showToast('CSV ë˜ëŠ” Excel(.xlsx, .xls) íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); return; }
        loading.classList.add('visible'); uploadArea.style.display = 'none';
        try {
            if (ext === 'csv') { const text = await readFileWithEncoding(file); parseCSV(text); } else { await parseExcel(file); }
            uploadArea.style.display = 'block'; uploadArea.classList.add('loaded');
            uploadArea.innerHTML = `<div class="icon">âœ…</div><h2>${escapeHtml(file.name)} (${formatNumber(allData.length)}ê±´ ë¡œë“œ ì™„ë£Œ)</h2>`;
            if (window._sheetNames && window._sheetNames.length > 1) {
                const ss = document.createElement('div'); ss.className = 'sheet-selector'; ss.style.cssText = 'margin-top:10px;display:flex;align-items:center;justify-content:center;gap:8px;';
                ss.innerHTML = '<span style="font-size:13px;color:#555;">ì‹œíŠ¸ ì„ íƒ:</span>';
                const sel = document.createElement('select'); sel.style.cssText = 'padding:6px 12px;border:1px solid #ccc;border-radius:6px;font-size:13px;font-family:inherit;cursor:pointer;';
                window._sheetNames.forEach((name, idx) => { const opt = document.createElement('option'); opt.value = idx; opt.textContent = name; if (idx === window._currentSheetIdx) opt.selected = true; sel.appendChild(opt); });
                sel.addEventListener('click', (e) => e.stopPropagation());
                sel.addEventListener('change', () => { window._currentSheetIdx = parseInt(sel.value); loadSheetData(window._workbookCache, window._sheetNames[window._currentSheetIdx]); setupAfterLoad(); showToast(`"${window._sheetNames[window._currentSheetIdx]}" ì‹œíŠ¸: ${formatNumber(allData.length)}ê±´ ë¡œë“œ ì™„ë£Œ`); });
                ss.addEventListener('click', (e) => e.stopPropagation()); ss.appendChild(sel); uploadArea.appendChild(ss);
            }
            setupAfterLoad(); showToast(`${formatNumber(allData.length)}ê±´ì˜ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } catch (err) { showToast('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message); uploadArea.style.display = 'block'; }
        finally { loading.classList.remove('visible'); }
    }

    function setupAfterLoad() {
        searchSection.classList.add('visible'); tableContainer.classList.add('visible');
        columnSelect.innerHTML = '<option value="all">ì „ì²´ ì»¬ëŸ¼ ê²€ìƒ‰</option>';
        headers.forEach((h, i) => { if (h.trim()) { const opt = document.createElement('option'); opt.value = i; opt.textContent = h; columnSelect.appendChild(opt); } });
        filteredData = [...allData]; currentPage = 1; sortCol = -1; renderTable(); searchInput.focus();
    }

    function readFileWithEncoding(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const bytes = new Uint8Array(e.target.result); let text;
                try { const d = new TextDecoder('utf-8', { fatal: true }); text = d.decode(bytes); if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1); if (!text.includes('\uFFFD')) { resolve(text); return; } } catch(e) {}
                try { const d = new TextDecoder('euc-kr', { fatal: false }); text = d.decode(bytes); resolve(text); return; } catch(e) {}
                const fr = new FileReader(); fr.onload = () => resolve(fr.result); fr.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨')); fr.readAsText(file);
            };
            reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨')); reader.readAsArrayBuffer(file);
        });
    }

    function parseExcel(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                try { const data = new Uint8Array(e.target.result); const wb = XLSX.read(data, { type: 'array', cellText: true, cellDates: true }); window._workbookCache = wb; window._sheetNames = wb.SheetNames; window._currentSheetIdx = 0; loadSheetData(wb, wb.SheetNames[0]); resolve(); }
                catch (err) { reject(new Error('Excel íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨: ' + err.message)); }
            };
            reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨')); reader.readAsArrayBuffer(file);
        });
    }

    function loadSheetData(wb, name) {
        const sheet = wb.Sheets[name]; const json = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: '', raw: false });
        let hi = 0; for (let i = 0; i < Math.min(10, json.length); i++) { if ((json[i] || []).filter(c => c !== undefined && c !== null && String(c).trim() !== '').length >= 3) { hi = i; break; } }
        headers = (json[hi] || []).map(h => String(h).trim()); while (headers.length > 0 && !headers[headers.length - 1]) headers.pop();
        allData = []; for (let i = hi + 1; i < json.length; i++) { const raw = json[i] || [], row = []; for (let j = 0; j < headers.length; j++) row.push(raw[j] !== undefined && raw[j] !== null ? String(raw[j]) : ''); if (row.every(c => !c.trim())) continue; allData.push(row); }
    }

    function parseCSV(text) {
        const rows = []; let current = '', inQuotes = false; const lines = [];
        for (let i = 0; i < text.length; i++) { const ch = text[i]; if (ch === '"') { if (inQuotes && i + 1 < text.length && text[i + 1] === '"') { current += '"'; i++; } else { inQuotes = !inQuotes; } } else if (ch === ',' && !inQuotes) { rows.push(current); current = ''; } else if ((ch === '\n' || ch === '\r') && !inQuotes) { if (ch === '\r' && i + 1 < text.length && text[i + 1] === '\n') i++; rows.push(current); current = ''; if (rows.length > 0 && rows.some(r => r.trim())) lines.push([...rows]); rows.length = 0; } else { current += ch; } }
        rows.push(current); if (rows.length > 0 && rows.some(r => r.trim())) lines.push([...rows]);
        let hi = 0; for (let i = 0; i < Math.min(5, lines.length); i++) { if (lines[i].filter(c => c.trim()).length >= 3) { hi = i; break; } }
        headers = lines[hi].map(h => h.trim()); while (headers.length > 0 && !headers[headers.length - 1]) headers.pop();
        allData = []; for (let i = hi + 1; i < lines.length; i++) { const row = lines[i].slice(0, headers.length); if (row.every(c => !c.trim())) continue; while (row.length < headers.length) row.push(''); allData.push(row); }
    }

    function doSearch() {
        searchTerm = searchInput.value.trim().toLowerCase(); searchColumn = columnSelect.value; currentPage = 1;
        if (!searchTerm) { filteredData = [...allData]; } else { filteredData = allData.filter(row => { if (searchColumn === 'all') return row.some(cell => cell.toLowerCase().includes(searchTerm)); else { const ci = parseInt(searchColumn); return row[ci] && row[ci].toLowerCase().includes(searchTerm); } }); }
        sortCol = -1; renderTable(); if (searchTerm) showToast(`"${searchInput.value.trim()}" ê²€ìƒ‰ ê²°ê³¼: ${formatNumber(filteredData.length)}ê±´`);
    }

    function doReset() { searchInput.value = ''; searchTerm = ''; searchColumn = 'all'; columnSelect.value = 'all'; sortCol = -1; currentPage = 1; filteredData = [...allData]; renderTable(); searchInput.focus(); }

    function doExport() {
        if (filteredData.length === 0) { showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
        let csv = '\uFEFF'; csv += headers.map(h => `"${h.replace(/"/g, '""')}"`).join(',') + '\n';
        filteredData.forEach(row => { csv += row.map(c => `"${c.replace(/"/g, '""')}"`).join(',') + '\n'; });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `ê²€ìƒ‰ê²°ê³¼_${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
        showToast(`${formatNumber(filteredData.length)}ê±´ì˜ ê²°ê³¼ë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.`);
    }

    function renderTable() {
        if (searchTerm) statsInfo.innerHTML = `ê²€ìƒ‰ ê²°ê³¼: <strong>${formatNumber(filteredData.length)}</strong>ê±´ / ì „ì²´ ${formatNumber(allData.length)}ê±´`;
        else statsInfo.innerHTML = `ì´ <strong>${formatNumber(allData.length)}</strong>ê±´ì˜ ë°ì´í„°`;
        let hh = '<tr><th class="row-num" style="cursor:default">No.</th>';
        headers.forEach((h, i) => { if (!h) return; const s = sortCol === i; const arrow = s ? (sortAsc ? 'â–²' : 'â–¼') : 'â†•'; hh += `<th class="${s ? 'sorted' : ''}" data-col="${i}">${escapeHtml(h)} <span class="sort-arrow">${arrow}</span></th>`; });
        hh += '</tr>'; tableHead.innerHTML = hh;
        tableHead.querySelectorAll('th[data-col]').forEach(th => { th.addEventListener('click', () => { const col = parseInt(th.dataset.col); if (sortCol === col) sortAsc = !sortAsc; else { sortCol = col; sortAsc = true; } filteredData.sort((a, b) => { const va = (a[col] || '').toLowerCase(), vb = (b[col] || '').toLowerCase(); if (va < vb) return sortAsc ? -1 : 1; if (va > vb) return sortAsc ? 1 : -1; return 0; }); currentPage = 1; renderTable(); }); });
        const start = (currentPage - 1) * perPage, end = Math.min(start + perPage, filteredData.length), pageData = filteredData.slice(start, end);
        let bh = '';
        if (pageData.length === 0) { bh = `<tr><td colspan="${headers.filter(h => h).length + 1}" style="text-align:center;padding:40px;color:#999;font-size:15px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`; }
        else { pageData.forEach((row, idx) => { bh += `<tr data-row="${start + idx}"><td class="row-num">${start + idx + 1}</td>`; headers.forEach((h, ci) => { if (!h) return; let ct = row[ci] || '', dt = escapeHtml(ct); if (ct.length > 150) dt = escapeHtml(ct.slice(0, 150)) + '<span style="color:#999">...</span>'; if (searchTerm && (searchColumn === 'all' || parseInt(searchColumn) === ci)) dt = highlightText(dt, searchTerm); bh += `<td>${dt}</td>`; }); bh += '</tr>'; }); }
        tableBody.innerHTML = bh;
        tableBody.querySelectorAll('tr[data-row]').forEach(tr => { tr.addEventListener('click', () => { showDetail(filteredData[parseInt(tr.dataset.row)]); }); tr.style.cursor = 'pointer'; });
        renderPagination();
    }

    function renderPagination() {
        const tp = Math.ceil(filteredData.length / perPage); if (tp <= 1) { pagination.innerHTML = ''; return; }
        let h = `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} data-page="${currentPage - 1}">â—€</button>`;
        const mv = 7; let sp = Math.max(1, currentPage - Math.floor(mv / 2)), ep = Math.min(tp, sp + mv - 1); if (ep - sp < mv - 1) sp = Math.max(1, ep - mv + 1);
        if (sp > 1) { h += `<button class="page-btn" data-page="1">1</button>`; if (sp > 2) h += '<span class="page-dots">...</span>'; }
        for (let i = sp; i <= ep; i++) h += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
        if (ep < tp) { if (ep < tp - 1) h += '<span class="page-dots">...</span>'; h += `<button class="page-btn" data-page="${tp}">${tp}</button>`; }
        h += `<button class="page-btn" ${currentPage === tp ? 'disabled' : ''} data-page="${currentPage + 1}">â–¶</button>`;
        pagination.innerHTML = h;
        pagination.querySelectorAll('.page-btn').forEach(btn => { btn.addEventListener('click', () => { const p = parseInt(btn.dataset.page); if (p >= 1 && p <= tp) { currentPage = p; renderTable(); tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); } }); });
    }

    function showDetail(row) {
        let h = ''; headers.forEach((hd, i) => { if (!hd) return; const val = row[i] || ''; if (!val.trim()) return; h += `<div class="detail-item"><div class="detail-label">${escapeHtml(hd)}</div><div class="detail-value">${escapeHtml(val)}</div></div>`; });
        if (!h) h = '<p style="color:#999;text-align:center">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; modalBody.innerHTML = h; modalOverlay.classList.add('visible');
    }

    function escapeHtml(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }
    function highlightText(html, term) { if (!term) return html; return html.replace(new RegExp(`(${escapeRegex(term)})`, 'gi'), '<span class="highlight">$1</span>'); }
    function escapeRegex(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
    function formatNumber(n) { return n.toLocaleString('ko-KR'); }
    function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }

    const AUTO_DATA_FILES = ['data.csv', 'data.xlsx', 'data.xls'];
    async function tryAutoLoad() {
        const al = document.getElementById('autoLoading');
        for (const fn of AUTO_DATA_FILES) {
            try {
                const resp = await fetch(fn); if (!resp.ok) continue;
                const ext = fn.split('.').pop().toLowerCase();
                if (ext === 'csv') { const buf = await resp.arrayBuffer(); const bytes = new Uint8Array(buf); let text; try { const d = new TextDecoder('utf-8', { fatal: true }); text = d.decode(bytes); if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1); if (text.includes('\uFFFD')) throw new Error('wrong'); } catch(e) { const d = new TextDecoder('euc-kr', { fatal: false }); text = d.decode(bytes); } parseCSV(text); }
                else { const buf = await resp.arrayBuffer(); const data = new Uint8Array(buf); const wb = XLSX.read(data, { type: 'array', cellText: true, cellDates: true }); window._workbookCache = wb; window._sheetNames = wb.SheetNames; window._currentSheetIdx = 0; loadSheetData(wb, wb.SheetNames[0]); }
                al.style.display = 'none'; uploadArea.style.display = 'block'; uploadArea.classList.add('loaded');
                let lh = `<div class="icon">âœ…</div><h2>ë°ì´í„° ìë™ ë¡œë“œ ì™„ë£Œ (${formatNumber(allData.length)}ê±´)</h2>`;
                if (window._sheetNames && window._sheetNames.length > 1) {
                    lh += '<div class="sheet-selector" style="margin-top:10px;display:flex;align-items:center;justify-content:center;gap:8px;"><span style="font-size:13px;color:#555;">ì‹œíŠ¸ ì„ íƒ:</span><select id="autoSheetSelect" style="padding:6px 12px;border:1px solid #ccc;border-radius:6px;font-size:13px;font-family:inherit;cursor:pointer;">';
                    window._sheetNames.forEach((name, idx) => { lh += `<option value="${idx}" ${idx === 0 ? 'selected' : ''}>${escapeHtml(name)}</option>`; });
                    lh += '</select></div>';
                }
                uploadArea.innerHTML = lh;
                const asel = document.getElementById('autoSheetSelect');
                if (asel) { asel.addEventListener('click', (e) => e.stopPropagation()); asel.addEventListener('change', () => { window._currentSheetIdx = parseInt(asel.value); loadSheetData(window._workbookCache, window._sheetNames[window._currentSheetIdx]); setupAfterLoad(); showToast(`"${window._sheetNames[window._currentSheetIdx]}" ì‹œíŠ¸: ${formatNumber(allData.length)}ê±´`); }); }
                setupAfterLoad(); showToast(`ë°ì´í„° ${formatNumber(allData.length)}ê±´ì´ ìë™ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`); return;
            } catch(e) { continue; }
        }
        al.style.display = 'none'; uploadArea.style.display = 'block';
    }
    tryAutoLoad();
})();
</script>
</body>
</html>


